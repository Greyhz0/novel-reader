<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eternal Reader - Valhalla</title>

  <!-- React Dependencies -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    }
    .line-clamp-1 {
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 1;
    }
    .line-clamp-2 {
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 2;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- Icons (inline) ---
    const BookOpen = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
    const Zap = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
    const Moon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>;
    const Menu = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>;
    const X = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
    const Search = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
    const Star = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
    const TrendingUp = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
    const BookMarked = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><polyline points="10 2 10 10 13 7 16 10 16 2"/></svg>;
    const LogIn = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>;
    const ChevronRight = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 18 6-6-6-6"/></svg>;
    const Home = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;

    // --- MOCK DATA ---
    const MOCK_NOVELS = [
      {
        id: 'nov-1',
        title: "Omniscient Reader's Viewpoint",
        type: "novel",
        cover: "https://m.media-amazon.com/images/I/71a+tEtvLAL._UF1000,1000_QL80_.jpg",
        rating: 4.9,
        chapters: 551,
        status: "Completed",
        genre: ["Fantasy", "Action", "Adventure"],
        description: "Dokja was an average office worker whose sole interest was reading his favorite web novel. But when the novel suddenly becomes reality, he's the only person who knows how the story ends.",
        link: "https://novelfire.net/book/omniscient-readers-viewpoint"
      },
      {
        id: 'nov-2',
        title: "Solo Leveling (Novel)",
        type: "novel",
        cover: "https://images.unsplash.com/photo-1618336753974-aae8e04506aa?w=300&h=400&fit=crop",
        rating: 4.9,
        chapters: 179,
        status: "Completed",
        genre: ["Action", "Fantasy"],
        description: "The novel version of Solo Leveling (Only I Level Up).",
        link: "https://novelfire.net/book/only-i-level-up"
      },
      {
        id: 'nov-3',
        title: "The Beginning After The End",
        type: "novel",
        cover: "https://images.unsplash.com/photo-1532012197267-da84d127e765?w=300&h=400&fit=crop",
        rating: 4.7,
        chapters: 478,
        status: "Ongoing",
        genre: ["Fantasy", "Adventure"],
        description: "King Grey has unrivaled strength, wealth, and prestige in a world governed by martial ability.",
        link: "https://novelfire.net/book/the-beginning-after-the-end"
      },
      {
        id: 'nov-4',
        title: "Shadow Slave",
        type: "novel",
        cover: "https://images.unsplash.com/photo-1520975698511-2a8b2a232f9b?w=300&h=400&fit=crop",
        rating: 4.5,
        chapters: 120,
        status: "Ongoing",
        genre: ["Action","Fantasy"],
        description: "Shadow Slave - epic cultivation and action.",
        link: "https://novelfire.net/book/shadow-slave"
      },
      {
        id: 'nov-5',
        title: "Trash of the Count's Family",
        type: "novel",
        cover: "https://images.unsplash.com/photo-1529070538774-1843cb3265df?w=300&h=400&fit=crop",
        rating: 4.6,
        chapters: 400,
        status: "Ongoing",
        genre: ["Comedy","Fantasy"],
        description: "Trash of the Count's Family ‚Äî isekai/romcom-light novel.",
        link: "https://novelfire.net/book/trash-of-the-counts-family"
      },
      {
        id: 'nov-6',
        title: "Return of Mount Hua Sect",
        type: "novel",
        cover: "https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=300&h=400&fit=crop",
        rating: 4.4,
        chapters: 200,
        status: "Ongoing",
        genre: ["Cultivation","Action"],
        description: "Return of Mount Hua Sect ‚Äî cultivation tale.",
        link: "https://novelfire.net/book/return-of-mount-hua-sect"
      },
      {
        id: 'nov-7',
        title: "A Regressor's Tale of Cultivation",
        type: "novel",
        cover: "https://images.unsplash.com/photo-1505678261036-a3fcc5e884ee?w=300&h=400&fit=crop",
        rating: 4.2,
        chapters: 180,
        status: "Ongoing",
        genre: ["Cultivation","Fantasy"],
        description: "A Regressor's Tale of Cultivation (external site).",
        link: "https://wetriedtls.com/series/a-regressors-tale-of-cultivation"
      },
      {
        id: 'man-1',
        title: "Solo Leveling (Manhwa)",
        type: "manhwa",
        cover: "https://images.unsplash.com/photo-1618336753974-aae8e04506aa?w=300&h=400&fit=crop",
        rating: 4.9,
        chapters: 179,
        status: "Completed",
        genre: ["Action", "Fantasy"],
        description: "Solo Leveling manhwa.",
        link: "https://novelfire.net/book/only-i-level-up"
      },
      {
        id: 'man-2',
        title: "Tower of God",
        type: "manhwa",
        cover: "https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=300&h=400&fit=crop",
        rating: 4.6,
        chapters: 595,
        status: "Ongoing",
        genre: ["Action", "Mystery"],
        description: "Tower of God manhwa.",
        link: ""
      }
    ];

    // --- Helper: LocalStorage progress ---
    const getProgressKey = (id) => `er:progress:${id}`;

    const readSavedProgress = (id) => {
      try {
        const raw = localStorage.getItem(getProgressKey(id));
        if (!raw) return 0;
        const parsed = parseInt(raw, 10);
        return isNaN(parsed) ? 0 : parsed;
      } catch (e) {
        console.warn('localStorage read error', e);
        return 0;
      }
    };

    const saveProgress = (id, chapterNum) => {
      try {
        localStorage.setItem(getProgressKey(id), String(chapterNum));
      } catch (e) {
        console.warn('localStorage save error', e);
      }
    };

    // --- App ---
    const NovelReaderApp = () => {
      const [novels, setNovels] = useState(MOCK_NOVELS);
      const [orvData, setOrvData] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedNovel, setSelectedNovel] = useState(null);
      const [currentChapter, setCurrentChapter] = useState(null);
      const [isMenuOpen, setIsMenuOpen] = useState(false);
      const [showLeaderboard, setShowLeaderboard] = useState(false);
      const [showAllNovels, setShowAllNovels] = useState(false);
      const [activeFilter, setActiveFilter] = useState('all');
      const [libraryMode, setLibraryMode] = useState('novel');
      const [progressTick, setProgressTick] = useState(0);

      // Load real ORV data - FIXED PATH
      useEffect(() => {
        fetch('./chapters/orv_chapters.json')
          .then(response => {
            if (!response.ok) throw new Error('Failed to load chapters');
            return response.json();
          })
          .then(data => {
            setOrvData(data);
            console.log(`‚úÖ Loaded ${Object.keys(data).length} ORV chapters`);
          })
          .catch(error => {
            console.error('‚ùå ORV data not loaded:', error);
          });
      }, []);

      const filteredNovels = novels.filter(novel => {
        if (novel.type !== libraryMode) return false;
        const q = searchTerm.trim().toLowerCase();
        const matchesSearch = !q || novel.title.toLowerCase().includes(q) || novel.description.toLowerCase().includes(q);
        const matchesFilter = activeFilter === 'all' || novel.type === activeFilter;
        return matchesSearch && matchesFilter;
      });

      // FIXED CHAPTER LOADING
      const getChapterContent = (novelId, chapterNum) => {
        // Use REAL ORV data for ORV novel
        if (novelId === 'nov-1' && orvData) {
          const realChapter = orvData[String(chapterNum)];
          if (realChapter) {
            return {
              title: realChapter.title || `Chapter ${chapterNum}`,
              content: realChapter.content || 'Content not available',
              novel: novels.find(n => n.id === novelId),
              chapterNumber: chapterNum,
              translator: realChapter.translator || "RainbowTurtle",
              editor: realChapter.editor || "Valhalla Team"
            };
          }
        }
        
        // Fallback for other novels
        const novel = novels.find(n => n.id === novelId) || {};
        return {
          title: `Chapter ${chapterNum}`,
          content: `This chapter is not available yet. Please check back later or visit the source site.`,
          novel,
          chapterNumber: chapterNum,
          translator: "Unknown",
          editor: "Unknown"
        };
      };

      const FeatureCard = ({ icon, title, description }) => (
        <div className="bg-gray-800 bg-opacity-50 backdrop-blur-md rounded-xl p-8 hover:bg-gray-700 transition-all transform hover:scale-105 border border-gray-700">
          <div className="flex justify-center mb-4">{icon}</div>
          <h3 className="text-xl font-bold text-white text-center mb-2">{title}</h3>
          <p className="text-gray-400 text-center">{description}</p>
        </div>
      );

      const NovelCard = ({ novel, onClick }) => {
        const progress = readSavedProgress(novel.id);
        return (
          <div
            onClick={() => onClick(novel)}
            className="group cursor-pointer bg-gray-800 rounded-lg overflow-hidden hover:shadow-2xl hover:shadow-purple-500/20 transition-all transform hover:scale-105 border border-gray-700"
          >
            <div className="relative overflow-hidden">
              <img
                src={novel.cover}
                alt={novel.title}
                className="w-full h-80 object-cover group-hover:scale-110 transition-transform duration-300"
              />
              <div className="absolute top-2 right-2 bg-black bg-opacity-70 px-2 py-1 rounded flex items-center">
                <Star className="w-4 h-4 text-yellow-400 fill-current mr-1" />
                <span className="text-white text-sm font-semibold">{novel.rating}</span>
              </div>
              <div className="absolute top-2 left-2">
                <span className={`px-2 py-1 rounded text-xs font-semibold ${
                  novel.type === 'novel' ? 'bg-blue-600' : 'bg-pink-600'
                }`}>
                  {novel.type.toUpperCase()}
                </span>
              </div>
            </div>
            <div className="p-4">
              <h3 className="text-lg font-bold text-white mb-2 group-hover:text-purple-400 transition-colors line-clamp-1">
                {novel.title}
              </h3>
              <div className="flex items-center text-sm text-gray-400 mb-2">
                <BookOpen className="w-4 h-4 mr-1" />
                <span>{novel.chapters} chapters</span>
              </div>
              <p className="text-gray-400 text-sm line-clamp-2">{novel.description}</p>
              <div className="mt-3 text-sm text-gray-300">
                Progress: <span className="text-purple-300 font-semibold">Chapter {progress} / {novel.chapters}</span>
              </div>
            </div>
          </div>
        );
      };

      const FilterButton = ({ label, filter, active, onClick }) => (
        <button
          onClick={() => onClick(filter)}
          className={`px-6 py-2 rounded-lg font-semibold transition-all ${
            active === filter
              ? 'bg-purple-600 text-white'
              : 'bg-gray-800 text-gray-400 hover:bg-gray-700'
          }`}
        >
          {label}
        </button>
      );

      const NavLink = ({ icon, text, onClick }) => (
        <button
          onClick={onClick}
          className="flex items-center space-x-2 text-gray-300 hover:text-white transition-colors"
        >
          {icon}
          <span>{text}</span>
        </button>
      );

      const MobileNavLink = ({ text, onClick }) => (
        <button
          onClick={onClick}
          className="block w-full text-left px-3 py-2 text-gray-300 hover:text-white hover:bg-gray-800 rounded-md transition-colors"
        >
          {text}
        </button>
      );

      const handleRandomNovel = () => {
        const pool = novels.filter(n => n.type === libraryMode);
        if (!pool.length) return;
        const randomIndex = Math.floor(Math.random() * pool.length);
        const n = pool[randomIndex];
        setSelectedNovel(n);
        setCurrentChapter(null);
        setShowAllNovels(false);
        setShowLeaderboard(false);
        setIsMenuOpen(false);
        window.scrollTo(0, 0);
      };

      const handleNovelsClick = () => {
        setSelectedNovel(null);
        setCurrentChapter(null);
        setShowLeaderboard(false);
        setShowAllNovels(true);
        setIsMenuOpen(false);
        window.scrollTo(0, 0);
      };

      const handleHomeClick = () => {
        setSelectedNovel(null);
        setCurrentChapter(null);
        setShowLeaderboard(false);
        setShowAllNovels(false);
        setIsMenuOpen(false);
        window.scrollTo(0, 0);
      };

      const handleLeaderboardClick = () => {
        setSelectedNovel(null);
        setCurrentChapter(null);
        setShowLeaderboard(true);
        setShowAllNovels(false);
        setIsMenuOpen(false);
        window.scrollTo(0, 0);
      };

      const switchLibraryMode = (mode) => {
        setLibraryMode(mode);
        setSelectedNovel(null);
        setCurrentChapter(null);
        setShowAllNovels(false);
        setShowLeaderboard(false);
      };

      const markNextChapter = (novel) => {
        const cur = readSavedProgress(novel.id);
        const next = Math.min(cur + 1, novel.chapters);
        saveProgress(novel.id, next);
        setProgressTick(t => t + 1);
      };

      const setProgressTo = (novelId, chapterNum) => {
        saveProgress(novelId, Math.max(0, chapterNum));
        setProgressTick(t => t + 1);
      };

      const HomePage = () => (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
          <div className="relative overflow-hidden">
            <div className="absolute inset-0 bg-black opacity-40"></div>
            <div className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-32 text-center">
              <h1 className="text-5xl md:text-7xl font-bold text-white mb-6">
                Eternal Reader
              </h1>
              <p className="text-xl md:text-2xl text-gray-300 mb-8 max-w-3xl mx-auto">
                Valhalla's premier destination for web novels and manhwa
              </p>
              <div className="flex flex-col sm:flex-row gap-4 justify-center items-center mb-12">
                <button
                  onClick={() => window.scrollTo({ top: 600, behavior: 'smooth' })}
                  className="px-8 py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-all transform hover:scale-105 shadow-lg"
                >
                  View our popular novels <span className="text-purple-300">here</span>
                </button>
              </div>
              <p className="text-gray-400 text-sm">
                Logged in users do not need to input the password.
              </p>
            </div>
          </div>

          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
              <FeatureCard
                icon={<BookOpen className="w-12 h-12 text-green-400" />}
                title="Extensive Library"
                description="Access a vast collection of novels with a single click."
              />
              <FeatureCard
                icon={<Zap className="w-12 h-12 text-orange-400" />}
                title="Fast Reading"
                description="Read chapters quickly and efficiently."
              />
              <FeatureCard
                icon={<Moon className="w-12 h-12 text-yellow-400" />}
                title="Dark Mode"
                description="Enjoy reading with an eye-friendly dark mode."
              />
            </div>
          </div>

          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div className="relative">
              <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
              <input
                type="text"
                placeholder={`Search ${libraryMode === 'novel' ? 'novels' : 'manhwa'}...`}
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="w-full pl-12 pr-4 py-4 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-all"
              />
            </div>
            <div className="flex gap-4 mt-4 justify-center flex-wrap">
              <FilterButton label="All" filter="all" active={activeFilter} onClick={setActiveFilter} />
              <FilterButton label="Novels" filter="novel" active={activeFilter} onClick={setActiveFilter} />
              <FilterButton label="Manhwa" filter="manhwa" active={activeFilter} onClick={setActiveFilter} />
            </div>
          </div>

          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <h2 className="text-3xl font-bold text-white mb-8">
              {libraryMode === 'novel' ? (activeFilter === 'all' ? 'All Novels' : 'Novels') : (activeFilter === 'all' ? 'All Manhwa' : 'Manhwa')}
            </h2>
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
              {filteredNovels.map(novel => (
                <NovelCard
                  key={novel.id}
                  novel={novel}
                  onClick={(n) => {
                    setSelectedNovel(n);
                    setShowAllNovels(false);
                    setShowLeaderboard(false);
                    window.scrollTo(0, 0);
                  }}
                />
              ))}
            </div>
          </div>
        </div>
      );

      const AllNovelsPage = () => (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <h1 className="text-4xl md:text-5xl font-bold text-white mb-4">All {libraryMode === 'novel' ? 'Novels' : 'Manhwa'}</h1>
            <p className="text-gray-400 mb-8">Browse the complete Eternal Reader collection</p>

            <div className="flex gap-4 mb-8 flex-wrap">
              <FilterButton label="All" filter="all" active={activeFilter} onClick={setActiveFilter} />
              <FilterButton label="Novels" filter="novel" active={activeFilter} onClick={setActiveFilter} />
              <FilterButton label="Manhwa" filter="manhwa" active={activeFilter} onClick={setActiveFilter} />
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
              {filteredNovels.map(novel => (
                <NovelCard
                  key={novel.id}
                  novel={novel}
                  onClick={(n) => {
                    setSelectedNovel(n);
                    setShowAllNovels(false);
                    window.scrollTo(0, 0);
                  }}
                />
              ))}
            </div>
          </div>
        </div>
      );

      const LeaderboardPage = () => {
        const sortedNovels = novels.filter(n => n.type === libraryMode).sort((a, b) => b.rating - a.rating);

        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
              <h1 className="text-4xl md:text-5xl font-bold text-white mb-4">üèÜ Valhalla Leaderboard</h1>
              <p className="text-gray-400 mb-8">Top rated {libraryMode === 'novel' ? 'novels' : 'manhwa'} in our collection</p>

              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                {sortedNovels.map((novel, index) => (
                  <div key={novel.id} className="relative">
                    {index < 3 && (
                      <div className="absolute -top-3 -right-3 z-10 bg-yellow-500 text-black font-bold rounded-full w-10 h-10 flex items-